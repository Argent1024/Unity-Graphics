# Documentation: https://internaldocs.hq.unity3d.com/copycat/

katana_abv_validate:
  name: Validate Katana ABV
  agent:
    type: Unity::VM
    image: slough-ops/ubuntu-18.04-base:latest
    flavor: b1.medium
  variables:
    MANIFEST: .copycat/graphics.json
    RELEASE_BRANCH: 2021.1/staging
  skip_checkout: true
  commands:
    - eval "$COPYCAT_1"
    - copycat vendor --revision "${GIT_TAG:-${GIT_BRANCH%%' (tag)'}}" --sha "$GIT_REVISION" "../destination/$MANIFEST"
    - copycat katana "../destination/$MANIFEST"

vendor:
  name: Vendor graphics (and create PR)
  agent:
    type: Unity::VM
    image: slough-ops/ubuntu-18.04-base:latest
    flavor: b1.medium
  variables:
    MANIFEST: .copycat/graphics.json
    RELEASE_BRANCH: 2021.1/staging
  skip_checkout: true
  commands:
    - eval "$COPYCAT_1"
    - copycat diff -o ../diff.patch "../destination/$MANIFEST"
    - copycat vendor --revision "${GIT_TAG:-${GIT_BRANCH%%' (tag)'}}" --sha "$GIT_REVISION" "../destination/$MANIFEST"
    - copycat ono "../destination/$MANIFEST" ../diff.patch
    - copycat katana "../destination/$MANIFEST"
